<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/png" href="img/favicon.png">
    <meta name="description" content="Food8 er en restaurationsgruppe af individuelle restauratører og madbutikker der har slået sig sammen. Find en madbutik lige efter din smag i København. Hos os finder du alt fra vinbarer til små delikatesse butikker, som står klar til at give dig en personlig og god service.">
    <title>FOOD8 | DELIKATESSER</title>
</head>

<body>
    <nav id="navigation" data-navigation></nav>

    <article id="indhold">
        <img class="retter" src="" data-restaurantpic>
        <h2 data-restaurantnavn></h2>
        <p data-restaurantbeskrivelse></p>
        <h3>Åbningstider</h3>
        <p data-tider></p>
        <h3>Kontakt</h3>
        <p data-kontakt></p>
        <h3>Adresse</h3>
        <p data-adresse></p>
        <h3>Kontrolrapport</h3>
        <a id="kontrolrapport" href="" data-kontrolrapport>Se kontrolrapport <span class="underline">her</span></a>
    </article>

    <div id="stor_footer">
        <div id="indhold">
            <h2 data-maptekst></h2>
            <div id="map"></div>
        </div>
        <footer id="footer" data-footer></footer>
    </div>
</body>

<script>
    async function hentJson() {
        let url = new URL(window.location.href);
        let parameter = new URLSearchParams(url.search);
        let id = parameter.get("id");
        let jsonData = await fetch("http://anjaholstnielsen.dk/kea/2sem/tema7/food8/wordpress/wp-json/wp/v2/delikatesser/" + id);
        let single = await jsonData.json();
        document.querySelector("[data-restaurantpic]").src = single.acf.foto.url;
        document.querySelector("[data-restaurantnavn]").textContent = single.acf.navn;
        document.querySelector("[data-restaurantbeskrivelse]").innerHTML = single.acf.beskrivelse;
        document.querySelector("[data-tider]").innerHTML = single.acf.aabningstider;
        document.querySelector("[data-adresse]").innerHTML = single.acf.adresse;
        document.querySelector("[data-kontakt]").innerHTML = single.acf.kontakt;
        document.querySelector("[data-kontrolrapport]").href = single.acf.kontrolrapport.url;
        document.querySelector("[data-maptekst]").textContent = "Besøg " + single.acf.navn + " her:";
    }
    async function hentMenu() {
        let topMenu = await fetch("navigation.html");
        let menu = await topMenu.text();
        document.querySelector("[data-navigation]").innerHTML = menu;
    }
    let restaurantKort;
    let map;

    function initMap() {
        var centrum = {
            lat: 55.690071,
            lng: 12.539130
        };
        map = new google.maps.Map(document.querySelector('#map'), {
            zoom: 10,
            center: centrum
        });
        hentWpDataTo();
    }
    async function hentWpDataTo() {
        let url = new URL(window.location.href);
        let parameter = new URLSearchParams(url.search);
        let id = parameter.get("id");
        let wpDataTo = await fetch("http://anjaholstnielsen.dk/kea/2sem/tema7/food8/wordpress/wp-json/wp/v2/delikatesser/" + id);
        //vis objekt som Json
        restaurantKort = await wpDataTo.json();
        let geocoder = new google.maps.Geocoder();
        visRestauranterKort(geocoder, map);
    }

    function visRestauranterKort(geocoder, resultsmap) {
        address = restaurantKort.acf.adresse;
        let navn = restaurantKort.acf.adresse;
        console.log(address);
        geocoder.geocode({
            'address': address
        }, function(results, status) {
            if (status === 'OK') {
                //resultsMap.setCenter(results[0].geometry.location);
                var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location,
                    title: navn,
                    icon: "grafik/pointer4.png",
                });

                //infovindue
                let infowindow = new google.maps.InfoWindow({
                    content: "<a href = " + "modtagdelikatesser.html?id=" + restaurantKort.id + ">" + "<h4>" + restaurantKort.acf.navn + "</h4>" + "</a>" + "<br>" +
                        navn + "<br>" + restaurantKort.acf.aabningstider,
                })

                //click åben infovindue
                marker.addListener('click', function() {
                    infowindow.open(map, marker);
                });

            } else {
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
    };
    async function hentFooter() {
        let footer = await fetch("footer.html");
        let footerIndhold = await footer.text();
        document.querySelector("[data-footer]").innerHTML = footerIndhold;
    }
    //hent indhold når siden er loaded
    document.addEventListener("DOMContentLoaded", hentJson);
    document.addEventListener("DOMContentLoaded", hentMenu);
    document.addEventListener("DOMContentLoaded", hentFooter);

</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOBMNsAjO4xPnmez3zADKyMOQICUN3a_M&callback=initMap">


</script>
