<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" type="image/png" href="img/favicon.png">
    <meta name="description" content="Food8 er en restaurationsgruppe af individuelle restauratører der har slået sig sammen. Find en retaurant lige efter din smag i København. Hos os finder du alt fra gourmetmad til lækker aftensmad på en hverdagsaften.">
    <title>FOOD8 | RESTAURANTER</title>
</head>


<body>
    <nav id="navigation" data-navigation></nav>
    <h2 class="overskrift">RESTAURANTER</h2>
    <section id="templateModtager"></section>
    <template id="restaurantTemplate">
       <article id="indhold_restaurant">
              <div class="retter_content">
                  <a data-restaurantknap2 href=""><img class="retter" src="" alt="" data-restaurantpic></a>
               <img class="retter_logo" src="" alt="" data-restaurantlogo>
                  <a data-restaurantknap3 href=""><h2 data-restaurantnavn></h2></a>
            <p class="retter_kort_beskrivelse" data-restaurantbeskrivelse></p>
            <a id="knap" data-restaurantknap href=""><button>Læs mere</button></a>
            <a id="knap" data-restaurantpdf href="img/menukort.pdf"><button>Menukort</button></a>
            <a id="knap" data-restaurantbook href=""><button>Book bord</button></a>
            </div>
       </article>
   </template>


    <div id="stor_footer">
        <div id="indhold">
            <h2>Find vores lækre restauranter og delikatesser her</h2>
            <div id="map"></div>
        </div>
        <footer id="footer" data-footer></footer>
    </div>

    <script>
        //Her starter ny kode

        let restaurantKort;
        let map;

        function initMap() {
            var centrum = {
                lat: 55.690071,
                lng: 12.539130
            };
            map = new google.maps.Map(document.querySelector('#map'), {
                zoom: 10,
                center: centrum
            });

            hentWpDataTo();
        }

        let restauranter;
        let templateModtager = document.querySelector("#templateModtager");
        let restaurantTemplate = document.querySelector("#restaurantTemplate");

        //hent Json
        async function hentWpData() {
            let wpData = await fetch("http://anjaholstnielsen.dk/kea/2sem/tema7/food8/wordpress/wp-json/wp/v2/restauranter");

            //vis objekt som Json
            restauranter = await wpData.json();
            visRestauranter();

        }

        async function hentWpDataTo() {
            let wpDataTo = await fetch("http://anjaholstnielsen.dk/kea/2sem/tema7/food8/wordpress/wp-json/wp/v2/restauranter");

            //vis objekt som Json

            restaurantKort = await wpDataTo.json();

            visRestauranterKort();
        }

        //lav en klon af template
        function visRestauranter() {
            restauranter.forEach(restaurant => {
                let klon = restaurantTemplate.cloneNode(true).content;
                klon.querySelector("[data-restaurantpic]").src = restaurant.acf.foto.url;
                klon.querySelector("[data-restaurantnavn]").textContent = restaurant.acf.navn;
                klon.querySelector("[data-restaurantlogo]").src = restaurant.acf.logo.url;
                klon.querySelector("[data-restaurantbeskrivelse]").innerHTML = restaurant.acf.kort_beskrivelse;
                klon.querySelector("[data-restaurantpdf]").href = restaurant.acf.menukort.url;
                klon.querySelector("[data-restaurantknap]").href = "modtagrestaurant.html?id=" + restaurant.id;
                klon.querySelector("[data-restaurantknap2]").href = "modtagrestaurant.html?id=" + restaurant.id;
                klon.querySelector("[data-restaurantknap3]").href = "modtagrestaurant.html?id=" + restaurant.id;
                klon.querySelector("[data-restaurantbook]").href = "modtagrestaurant.html?id=" + restaurant.id + "#book_bord";
                templateModtager.appendChild(klon);
            })
        }


        async function hentMenu() {
            let topMenu = await fetch("navigation.html");
            let menu = await topMenu.text();

            document.querySelector("[data-navigation]").innerHTML = menu;
        }

        function visRestauranterKort() {

            let geocoder = new google.maps.Geocoder();
            restaurantKort.forEach(restaurant => {

                address = restaurant.acf.adresse;
                let navn = restaurant.acf.adresse;
                console.log(address);
                geocoder.geocode({
                    'address': address
                }, function(results, status) {
                    if (status === 'OK') {
                        //resultsMap.setCenter(results[0].geometry.location);
                        var marker = new google.maps.Marker({
                            map: map,
                            position: results[0].geometry.location,
                            title: navn,
                            icon: "grafik/pointer4.png",
                        });

                        //infovindue
                        let infowindow = new google.maps.InfoWindow({
                            content: "<a href = " + "modtagrestaurant.html?id=" + restaurant.id + ">" + "<h4>" + restaurant.acf.navn + "</h4>" + "</a>" + "<br>" +
                                navn + "<br>" + "<br>" + restaurant.acf.abningstider,
                        })

                        //click åben infovindue
                        marker.addListener('click', function() {
                            infowindow.open(map, marker);
                        });

                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });
            });
        }



        async function hentFooter() {
            let footer = await fetch("footer.html");
            let footerIndhold = await footer.text();

            document.querySelector("[data-footer]").innerHTML = footerIndhold;
        }

        //hent indhold når siden er loaded 
        document.addEventListener("DOMContentLoaded", hentWpData);
        document.addEventListener("DOMContentLoaded", hentMenu);
        document.addEventListener("DOMContentLoaded", hentFooter);
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOBMNsAjO4xPnmez3zADKyMOQICUN3a_M&callback=initMap">
    </script>


</body>

</html>
